

<div id="page-wrapper">

    <div class="container-fluid">

        <!-- Page Heading -->
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">
                    Dashboard
                </h1>
                <ol class="breadcrumb">
                    <li class="active">
                        <i class="fa fa-dashboard"></i> Dashboard
                    </li>
                </ol>
            </div>
        </div>
        <!-- /.row -->

        <div class="row">
            <div class="col-lg-12">
            </div>
        </div>
        <!-- /.row -->

        <div class="row">

            <div class="col-lg-3 col-md-6">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                                <i class="fa fa-sitemap fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <div class="huge">40</div>
                                <div>중계기</div>
                            </div>
                        </div>
                    </div>
                    <a href="#">
                        <div class="panel-footer">
                            <span class="pull-left">View Details</span>
                            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                            <div class="clearfix"></div>
                        </div>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="panel panel-yellow">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                                <i class="fa fa-rss-square fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <div class="huge">30</div>
                                <div>감지기</div>
                            </div>
                        </div>
                    </div>
                    <a href="#">
                        <div class="panel-footer">
                            <span class="pull-left">View Details</span>
                            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                            <div class="clearfix"></div>
                        </div>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="panel panel-red">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                                <i class="glyphicon glyphicon-exclamation-sign fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <div class="huge">13</div>
                                <div>주의</div>
                            </div>
                        </div>
                    </div>
                    <a href="#">
                        <div class="panel-footer">
                            <span class="pull-left">View Details</span>
                            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                            <div class="clearfix"></div>
                        </div>
                    </a>

                </div>
            </div>


            <div class="col-lg-3 col-md-6">

                <div id="test5" class="panel panel-green">

                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                              <div id ="test3">
                                <i class="fa fa-smile-o fa-5x"></i>
                            </div>
                          </div>
                            <div class="col-xs-9 text-center">
                                <div id="test6"class="huge">양호</div>
                                <div>1번도로</div>
                            </div>
                        </div>
                    </div>
                    <a href="#">
                        <div class="panel-footer">
                            <span class="pull-left">실시간 상황</span>
                            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                            <div class="clearfix"></div>
                        </div>
                    </a>

                </div>
            </div>

        </div>



        <br>
        <div class ="row">

        <div class="col-lg-7">
          <label>Selects</label>
          <select class="form-control">
              <option>1 번도로</option>
              <option>2 번도로</option>
              <option>3 번도로</option>
              <option>4 번도로</option>
              <option>5 번도로</option>
          </select>
            <canvas id="canvas" width="50%" height="25%";>

            </canvas>

        </div>
        <br>
        <div class="col-lg-5">

        <div id = "googleMap" style="width:100%;height:320px;"></div>
      </div>
        <br>
        <br>

        <div class="col-lg-7">
          <label>Selects</label>
          <select class="form-control">
              <option>1 번도로</option>
              <option>2 번도로</option>
              <option>3 번도로</option>
              <option>4 번도로</option>
              <option>5 번도로</option>
          </select>
            <canvas id="canvas2" width="50%" height="25%";></canvas>

        </div>
        <br>

        <div class="col-lg-5">
          <br>
          <div id = "googleMap2" style="width:100%;height:320px;"></div>
      </div>
        <!--
        <button id="addDataset">Add Dataset</button>
        <button id="removeDataset">Remove Dataset</button>
        <button id="addData">Add Data</button>
        <button id="removeData">Remove Data</button>
      -->
        <script>

            //var MONTHS = [];
            var randomScalingFactor = function() {
                return Math.round(Math.random() * 100 * (Math.random() > 0.5 ? -1 : 1));
            };
            var randomColorFactor = function() {
                return Math.round(Math.random() * 255);
            };
            var randomColor = function(opacity) {
                return 'rgba(' + randomColorFactor() + ',' + randomColorFactor() + ',' + randomColorFactor() + ',' + (opacity || '.3') + ')';
            };
            var config = {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                    {
                        label: "1번 구역",
                        data: [],
                        //length:data.length,
                        lineTension: 0,
                        fill: false,
                    }, ]
                },
                options: {
                    responsive: true,
                    legend: {
                        position: 'bottom',
                    },
                    hover: {
                        mode: 'label'
                    },
                    scales: {
                        xAxes: [{

                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'data'
                            }
                        }],
                        yAxes: [{
                            ticks:{
                              suggestedMax: 200,
                              beginAtZero: true
                            },
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Time'
                            }
                        }]
                    },
                    title: {
                        display: true,
                        text: '1번 도로'
                    }
                }
            };

            $.each(config.data.datasets, function(i, dataset) {
                var background = randomColor(0.5);
                dataset.borderColor = background;
                dataset.backgroundColor = background;
                dataset.pointBorderColor = background;
                dataset.pointBackgroundColor = background;
                dataset.pointBorderWidth = 1;
            });
            $.each(config.data.datasets, function(i, dataset) {
                var background = randomColor(0.5);
                dataset.borderColor = background;
                dataset.backgroundColor = background;
                dataset.pointBorderColor = background;
                dataset.pointBackgroundColor = background;
                dataset.pointBorderWidth = 1;
            });

            window.onload = function() {
                var ctx = document.getElementById("canvas").getContext("2d");
                var ctx2 = document.getElementById("canvas2").getContext("2d");
                window.myLine1 = new Chart(ctx, config);
                window.myLine2 = new Chart(ctx2, config);
                console.log(config.data.datasets.data);
            };
      </script>


        <script src="/socket.io/socket.io.js"></script>
        <script>
        var socket = io.connect("http://localhost:3000");
        var check_icon = $("#test3 i");
        var check_color = $("#test5");
        var check_text = $("#test6");
        socket.on('chat message',function (msg) {
          console.log("chat message: ",msg);
          var accdata = msg/100;
          var count=0;
          /*
          if(msg>100){
            console.log('주의');
            window.onload = function() {
                var test2 = document.getElementById("test4");
                window.alert=
            };

          }
*/
          if(100<accdata){
            if(accdata>150){
              check_text.text("위험");
              check_color.removeClass("panel-green");
              check_color.removeClass("panel-yellow");
              check_icon.removeClass("fa-smile-o");
              check_icon.removeClass("fa-meh-o");
              check_color.addClass("panel-red");
              check_icon.addClass("fa-frown-o");
            }
            else{
              check_text.text("주의");
              check_color.removeClass("panel-green");
              check_color.removeClass("panel-yellow");
              check_icon.removeClass("fa-smile-o");
              check_icon.removeClass("fa-frown-o");
              check_color.addClass("panel-yellow");
              check_icon.addClass("fa-meh-o");
            }
          }
          else
          {
            check_text.text("양호");
            check_color.removeClass("panel-yellow");
            check_color.removeClass("panel-red");
            check_icon.removeClass("fa-meh-o");
            check_icon.removeClass("fa-frown-o");
            check_color.addClass("panel-green");
            check_icon.addClass("fa-smile-o");
          }
          if (config.data.datasets.length > 0) {
              var now = new Date();
              var hour = now.getHours();
              var min = now.getMinutes();
              var second = now.getSeconds();
              config.data.labels.push(hour+":"+min+":"+second);

              if(config.data.labels.length==21){
                $.each(config.data.datasets, function(i, dataset) {
                    config.data.labels.shift(0,21);
                    dataset.data.shift(0,20);
                    dataset.data.push(accdata);
                });
              }
              else{
              $.each(config.data.datasets, function(i, dataset) {
                  dataset.data.push(accdata);
              });
            }

              window.myLine1.update();
              window.myLine2.update();
          }
        });



        </script>



        </div>


    </div>
    <!-- /.container-fluid -->

</div>
